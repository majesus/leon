<!DOCTYPE html>
<html>
<head>
    <title>La Aventura Espacial de León - Versión Mega Divertida</title>
    <style>
        /* Ajustes generales de la página */
        body {
            margin: 0;
            overflow: hidden;
            background: black;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            font-family: Arial, sans-serif;
        }

        /* Canvas con borde para resaltar el área de juego */
        #gameCanvas {
            border: 2px solid #333;
        }

        /* Overlays: inicio, final, etc. */
        .overlay {
            position: absolute;
            color: white;
            font-size: 48px;
            text-align: center;
            background: rgba(0,0,0,0.8);
            padding: 20px;
            border-radius: 10px;
            display: none;
        }

        /* Marcador de puntos */
        #score {
            position: absolute;
            top: 20px;
            left: 20px;
            color: white;
            font-size: 24px;
        }

        /* Efecto parpadeante */
        .blink {
            animation: blinking 1.2s infinite;
        }
        @keyframes blinking {
            0%   { opacity: 1;   }
            50%  { opacity: 0.2; }
            100% { opacity: 1;   }
        }

        /* Superposición para la transición de pantalla negra */
        #blackOverlay {
            position: absolute;
            top: 0; left: 0;
            width: 0; 
            height: 0;
            background: black;
            opacity: 0; 
            z-index: 5;
        }

        /* Contenedor para los marcianitos bailando */
        #dancingAliens {
            position: absolute;
            top: 0;
            left: 0;
            width: 800px;
            height: 600px;
            pointer-events: none;
            display: none; /* Se mostrará tras la "muerte" */
        }
        .alien {
            position: absolute;
            width: 40px;
            height: 40px;
            background-color: green;
            border-radius: 50%;
            animation: dance 1s infinite alternate;
        }
        @keyframes dance {
            0%   { transform: translateY(0);   }
            100% { transform: translateY(-20px); }
        }
    </style>
</head>
<body>
    <!-- Marcador de puntos -->
    <div id="score">Puntos: <span id="scoreValue">0</span></div>
    
    <!-- Lienzo para el juego -->
    <canvas id="gameCanvas"></canvas>
    
    <!-- Pantalla de inicio -->
    <div id="startScreen" class="overlay">
        <div style="font-size: 72px; color: #FFD700; margin-bottom: 20px;" class="blink">¡LEÓN!</div>
        Presiona ENTER para comenzar<br>
        <div style="font-size: 24px; margin-top: 20px;">
            ↑↓←→ para mover<br>
            ESPACIO para disparar
        </div>
    </div>

    <!-- Pantalla final (ahora será dinámica) -->
    <div id="gameOver" class="overlay" style="font-size: 60px;">
        <!-- Se rellena dinámicamente con “¡Loser!” -->
    </div>

    <!-- Superposición negra para la transición de "muerte" -->
    <div id="blackOverlay"></div>

    <!-- Contenedor para los marcianitos bailando -->
    <div id="dancingAliens"></div>

    <script>
        /********************************************
         * Variables y configuración
         ********************************************/
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        canvas.width = 800;
        canvas.height = 600;

        // Referencias a los elementos HTML
        const startScreenDiv = document.getElementById('startScreen');
        const gameOverDiv = document.getElementById('gameOver');
        const scoreValueDiv = document.getElementById('scoreValue');
        const blackOverlay = document.getElementById('blackOverlay');
        const dancingAliensDiv = document.getElementById('dancingAliens');

        let gameState = 'start'; // 'start', 'playing', 'gameOver', 'dance'
        let score = 0;

        let bullets = [];
        let enemies = [];
        let explosionParticles = [];

        // Configuración del jugador (León)
        const player = {
            x: canvas.width / 2,
            y: canvas.height - 100,
            width: 50,
            height: 50,
            speed: 5,
            color: '#FFD700'
        };

        // Tipos de enemigos, con distintas características
        const enemyTypes = [
            { color: '#F00', width: 30, height: 30, speed: 2,   points: 10 },
            { color: '#0F0', width: 40, height: 40, speed: 1.5, points: 20 },
            { color: '#00F', width: 50, height: 50, speed: 1,   points: 30 }
        ];

        // Control de teclas
        const keys = {};
        document.addEventListener('keydown', (e) => {
            keys[e.code] = true;

            if (e.key === 'Enter') {
                if (gameState === 'start') {
                    startGame();
                } else if (gameState === 'gameOver') {
                    resetGame();
                }
            }

            if (gameState === 'playing' && e.code === 'Space') {
                shoot();
            }
        });
        document.addEventListener('keyup', (e) => {
            keys[e.code] = false;
        });

        /********************************************
         * Funciones principales de juego
         ********************************************/
        function startGame() {
            gameState = 'playing';
            startScreenDiv.style.display = 'none';
            resetGame();
        }

        function resetGame() {
            gameState = 'playing';
            gameOverDiv.style.display = 'none';
            blackOverlay.style.width = '0';
            blackOverlay.style.height = '0';
            blackOverlay.style.opacity = '0';
            dancingAliensDiv.style.display = 'none';
            dancingAliensDiv.innerHTML = ''; // Vaciar bailarines
            score = 0;
            scoreValueDiv.textContent = score;
            enemies = [];
            bullets = [];
            explosionParticles = [];
            player.x = canvas.width / 2;
            player.y = canvas.height - 100;
        }

        function shoot() {
            // Limitamos cuántas balas hay en pantalla
            if (bullets.length < 5) {
                bullets.push({
                    x: player.x + player.width / 2 - 2.5,
                    y: player.y,
                    width: 5,
                    height: 10
                });
            }
        }

        function update() {
            if (gameState !== 'playing') return;

            // Movimiento del jugador
            if (keys['ArrowLeft'] && player.x > 0) {
                player.x -= player.speed;
            }
            if (keys['ArrowRight'] && player.x < canvas.width - player.width) {
                player.x += player.speed;
            }
            if (keys['ArrowUp'] && player.y > 0) {
                player.y -= player.speed;
            }
            if (keys['ArrowDown'] && player.y < canvas.height - player.height) {
                player.y += player.speed;
            }

            // Actualizamos balas
            bullets = bullets.filter(bullet => {
                bullet.y -= 7;
                return bullet.y > 0;
            });

            // Generamos nuevos enemigos con probabilidad fija
            if (Math.random() < 0.02) {
                createRandomEnemy();
            }

            // Movemos enemigos y verificamos colisiones
            enemies = enemies.filter(enemy => {
                enemy.y += enemy.speed;

                // Colisión jugador-enemigo => disparar secuencia de "muerte"
                if (checkCollision(enemy, player)) {
                    createExplosion(player.x + player.width / 2, player.y + player.height / 2);
                    triggerDeathSequence();
                    return false;
                }

                // Colisión bala-enemigo => sumar puntos y eliminar
                for (let bullet of bullets) {
                    if (checkCollision(enemy, bullet)) {
                        createExplosion(enemy.x + enemy.width / 2, enemy.y + enemy.height / 2);
                        score += enemy.points;
                        scoreValueDiv.textContent = score;
                        bullets = bullets.filter(b => b !== bullet);
                        return false;
                    }
                }
                // Enemigo sigue en pantalla
                return enemy.y < canvas.height;
            });

            // Actualizar partículas de explosión
            explosionParticles = explosionParticles.filter(particle => {
                particle.x += particle.vx;
                particle.y += particle.vy;
                particle.life--;
                return particle.life > 0;
            });
        }

        function draw() {
            // Fondo negro
            ctx.fillStyle = 'black';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Estrellas animadas
            ctx.fillStyle = 'white';
            for (let i = 0; i < 100; i++) {
                ctx.fillRect(
                    Math.sin(Date.now() * 0.001 + i) * canvas.width / 2 + canvas.width / 2,
                    (i * 6 + Date.now() * 0.1) % canvas.height,
                    2,
                    2
                );
            }

            if (gameState === 'playing') {
                // Dibujar jugador
                drawLeon(player.x, player.y);

                // Dibujar balas
                ctx.fillStyle = '#FF0';
                bullets.forEach(bullet => {
                    ctx.fillRect(bullet.x, bullet.y, bullet.width, bullet.height);
                });

                // Dibujar enemigos (triángulos de distinto tamaño/color)
                enemies.forEach(enemy => {
                    drawTriangleEnemy(enemy);
                });
            }

            // Dibujar partículas de explosión
            explosionParticles.forEach(particle => {
                ctx.fillStyle = `rgba(255, ${Math.random() * 255}, 0, ${particle.life / 50})`;
                ctx.fillRect(particle.x, particle.y, 3, 3);
            });
        }

        /********************************************
         * Funciones auxiliares
         ********************************************/
        // Crea un enemigo con características aleatorias
        function createRandomEnemy() {
            const type = enemyTypes[Math.floor(Math.random() * enemyTypes.length)];
            enemies.push({
                x: Math.random() * (canvas.width - type.width),
                y: 0,
                width: type.width,
                height: type.height,
                speed: type.speed,
                color: type.color,
                points: type.points
            });
        }

        // Verifica colisiones rectangulares
        function checkCollision(rect1, rect2) {
            return rect1.x < rect2.x + rect2.width &&
                   rect1.x + rect1.width > rect2.x &&
                   rect1.y < rect2.y + rect2.height &&
                   rect1.y + rect1.height > rect2.y;
        }

        // Crear partículas de explosión
        function createExplosion(x, y) {
            for (let i = 0; i < 30; i++) {
                const angle = (Math.PI * 2 / 30) * i;
                explosionParticles.push({
                    x: x,
                    y: y,
                    vx: Math.cos(angle) * 5,
                    vy: Math.sin(angle) * 5,
                    life: 50
                });
            }
        }

        // Dibujar jugador (León)
        function drawLeon(x, y) {
            ctx.save();
            ctx.translate(x + 25, y + 25);
            // Cuerpo (triángulo dorado)
            ctx.beginPath();
            ctx.moveTo(-25, 15);
            ctx.lineTo(25, 15);
            ctx.lineTo(0, -25);
            ctx.closePath();
            ctx.fillStyle = player.color;
            ctx.fill();
            // Melena
            ctx.beginPath();
            ctx.arc(0, 0, 20, 0, Math.PI * 2);
            ctx.fillStyle = '#FFA500';
            ctx.fill();
            // Cara
            ctx.beginPath();
            ctx.arc(0, 0, 15, 0, Math.PI * 2);
            ctx.fillStyle = '#FFD700';
            ctx.fill();
            // Ojos
            ctx.fillStyle = 'black';
            ctx.beginPath();
            ctx.arc(-5, -2, 3, 0, Math.PI * 2);
            ctx.arc(5, -2, 3, 0, Math.PI * 2);
            ctx.fill();
            ctx.restore();
        }

        // Dibujar enemigo en forma de triángulo según su tamaño y color
        function drawTriangleEnemy(enemy) {
            ctx.fillStyle = enemy.color;
            ctx.beginPath();
            ctx.moveTo(enemy.x + enemy.width / 2, enemy.y);
            ctx.lineTo(enemy.x, enemy.y + enemy.height);
            ctx.lineTo(enemy.x + enemy.width, enemy.y + enemy.height);
            ctx.closePath();
            ctx.fill();
        }

        // Secuencia de muerte: pantalla negra, marcianitos bailando, “¡Loser!”
        function triggerDeathSequence() {
            gameState = 'gameOver';
            // Expandir overlay negro
            expandBlackOverlay(() => {
                // Crear marcianitos bailando
                createDancingAliens();
                // Mostrar div con marcianitos
                dancingAliensDiv.style.display = 'block';
                // Tras 3 segundos, mostrar “¡Loser!”
                setTimeout(() => {
                    dancingAliensDiv.style.display = 'none';
                    gameOverDiv.textContent = '¡Loser!';
                    gameOverDiv.style.display = 'block';
                }, 3000);
            });
        }

        // Función que expande el overlay negro en toda la pantalla
        function expandBlackOverlay(callback) {
            blackOverlay.style.width = canvas.width + 'px';
            blackOverlay.style.height = canvas.height + 'px';
            blackOverlay.style.opacity = '1';

            // Pequeño retardo para que se note el “fade”
            setTimeout(() => {
                callback();
            }, 1000);
        }

        // Generar varios marcianitos bailando aleatoriamente
        function createDancingAliens() {
            for (let i = 0; i < 10; i++) {
                const alien = document.createElement('div');
                alien.classList.add('alien');
                // Posiciones aleatorias en el contenedor
                alien.style.top = Math.random() * (600 - 40) + 'px';
                alien.style.left = Math.random() * (800 - 40) + 'px';
                // Color aleatorio
                alien.style.backgroundColor = getRandomColor();
                dancingAliensDiv.appendChild(alien);
            }
        }

        // Generar color aleatorio para los alien
        function getRandomColor() {
            const letters = '0123456789ABCDEF';
            let color = '#';
            for (let i = 0; i < 6; i++) {
                color += letters[Math.floor(Math.random() * 16)];
            }
            return color;
        }

        /********************************************
         * Bucle de animación principal
         ********************************************/
        function gameLoop() {
            update();
            draw();
            requestAnimationFrame(gameLoop);
        }
        gameLoop();

    </script>
</body>
</html>
